<?xml version="1.0" encoding="utf-8" ?>
<Patch>

  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Vanilla Weapons Expanded - Heavy Weapons</li>
    </mods>
    <match Class="PatchOperationSequence">
      <operations>

        <!-- === Replace default verbClass === -->
        <li Class="PatchOperationReplace">
          <xpath>
            /Defs/ThingDef[
              defName = "VWE_Gun_Autocannon" or
              defName = "VWE_Gun_HandheldMortar"
            ]/verbs/li/verbClass
          </xpath>
          <value>
            <verbClass>Verb_Shoot</verbClass>
          </value>
        </li>

        <li Class="PatchOperationRemove">
          <xpath>
            /Defs/ThingDef[
              defName = "VWE_Gun_Autocannon" or
              defName = "VWE_Gun_HandheldMortar"
            ]/comps/li[compClass="CompOversizedWeapon.CompOversizedWeapon"]
          </xpath>
        </li>

        <!-- === Autocannon === -->
        <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
          <defName>VWE_Gun_Autocannon</defName>
          <statBases>
            <Mass>25</Mass>
            <Bulk>22</Bulk>
            <SwayFactor>1.54</SwayFactor>
            <ShotSpread>0.10</ShotSpread>
            <SightsEfficiency>0.5</SightsEfficiency>
            <RangedWeapon_Cooldown>0.56</RangedWeapon_Cooldown>
          </statBases>
          <Properties>
            <verbClass>CombatExtended.Verb_ShootCE</verbClass>
            <hasStandardCommand>True</hasStandardCommand>
            <defaultProjectile>Bullet_20x102mmNATO_FMJ</defaultProjectile>
            <recoilAmount>2</recoilAmount>
            <burstShotCount>10</burstShotCount>
            <ticksBetweenBurstShots>13</ticksBetweenBurstShots>
            <warmupTime>3</warmupTime>
            <range>50</range>
            <minRange>3</minRange>
            <soundCast>Shot_Autocannon</soundCast>
            <soundCastTail>GunTail_Heavy</soundCastTail>
            <muzzleFlashScale>12</muzzleFlashScale>
          </Properties>
          <AmmoUser>
            <magazineSize>50</magazineSize>
            <reloadTime>8</reloadTime>
            <ammoSet>AmmoSet_20x102mmNATO</ammoSet>
          </AmmoUser>
          <FireModes>
            <aiAimMode>AimedShot</aiAimMode>
            <aiUseBurstMode>True</aiUseBurstMode>
            <aimedBurstShotCount>5</aimedBurstShotCount>
          </FireModes>
        </li>

        <li Class="PatchOperationAddModExtension">
          <xpath>/Defs/ThingDef[defName="VWE_Gun_Autocannon"]</xpath>
          <value>
            <li Class="CombatExtended.GunDrawExtension">
              <DrawSize>1.3,1.3</DrawSize>
              <DrawOffset>0.10,-0.22</DrawOffset>
            </li>
          </value>
        </li>

        <!-- === Handheld Mortar === -->
        <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
          <defName>VWE_Gun_HandheldMortar</defName>
          <statBases>
            <Mass>30</Mass>
            <Bulk>30</Bulk>
            <SwayFactor>1.54</SwayFactor>
            <ShotSpread>0.10</ShotSpread>
            <SightsEfficiency>0.5</SightsEfficiency>
            <RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
          </statBases>
          <Properties>
            <verbClass>CombatExtended.Verb_ShootMortarCE</verbClass>
            <hasStandardCommand>True</hasStandardCommand>
            <defaultProjectile>Bullet_60mmMortarShell_HE</defaultProjectile>
            <warmupTime>3.5</warmupTime>
            <range>66</range>
            <minRange>16</minRange>
            <soundCast>Mortar_LaunchA</soundCast>
            <soundCastTail>GunTail_Heavy</soundCastTail>
            <muzzleFlashScale>16</muzzleFlashScale>
            <circularError>1</circularError>
            <indirectFirePenalty>0.2</indirectFirePenalty>
            <targetParams>
              <canTargetLocations>true</canTargetLocations>
            </targetParams>
          </Properties>
          <AmmoUser>
            <magazineSize>1</magazineSize>
            <reloadTime>6</reloadTime>
            <ammoSet>AmmoSet_60mmMortarShell</ammoSet>
          </AmmoUser>
          <FireModes>
            <aiAimMode>AimedShot</aiAimMode>
          </FireModes>
        </li>

        <li Class="PatchOperationAdd">
          <xpath>/Defs/ThingDef[defName="VWE_Gun_HandheldMortar"]/comps</xpath>
          <value>
            <li Class="CombatExtended.CompProperties_Charges">
              <chargeSpeeds>
                <li>30</li>
                <li>50</li>
                <li>70</li>
                <li>90</li>
              </chargeSpeeds>
            </li>
          </value>
        </li>

        <li Class="PatchOperationAddModExtension">
          <xpath>/Defs/ThingDef[defName="VWE_Gun_HandheldMortar"]</xpath>
          <value>
            <li Class="CombatExtended.GunDrawExtension">
              <DrawSize>1.3,1.3</DrawSize>
              <DrawOffset>0.10,-0.20</DrawOffset>
            </li>
          </value>
        </li>

        <!-- === Heavy Flamer === -->
        <!-- === Missile Launcher === -->
        <!-- === Slug Rifle === -->

      </operations>
    </match>
  </Operation>

</Patch>