<?xml version="1.0" encoding="utf-8" ?>
<Patch>

    <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Medieval Overhaul</li>
    </mods>
    <match Class="PatchOperationSequence">
        <operations>

        <li Class="PatchOperationAttributeSet">
            <xpath>Defs/ThingDef[@Name="DankPyon_Medieval_MakeableGrenade"]</xpath>
            <attribute>ParentName</attribute>
            <value>BaseWeapon</value>
        </li>

        <!-- ========== Fire Bomb ========== -->

        <!-- Projectile -->

        <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[defName="DankPyon_Proj_PotFire"]/projectile</xpath>
            <value>
                <projectile Class="CombatExtended.ProjectilePropertiesCE">
                    <explosionRadius>1.1</explosionRadius>
                    <damageDef>Flame</damageDef>
                    <damageAmountBase>10</damageAmountBase>
                    <preExplosionSpawnThingDef>Filth_Fuel</preExplosionSpawnThingDef>
                    <preExplosionSpawnChance>1</preExplosionSpawnChance>
                    <speed>10</speed>
                    <ai_IsIncendiary>true</ai_IsIncendiary>
                    <gravityFactor>2</gravityFactor>
                </projectile>
            </value>
        </li>

        <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="DankPyon_Proj_PotFire"]</xpath>
            <value>
                <thingClass>CombatExtended.Projectile_FireTrail</thingClass>
            </value>
        </li>

        <!-- Grenade -->
<!--
        <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[defName="DankPyon_Weapon_PotFire"]/graphicData</xpath>
            <value>
                <graphicData>
                    <texPath>Things/Projectile/FireBombThrown</texPath>
                    <graphicClass>Graphic_Single</graphicClass>
                </graphicData> 
            </value>
        </li>
-->
        <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="DankPyon_Weapon_PotFire"]</xpath>
            <value>
                <thingClass>CombatExtended.AmmoThing</thingClass>
                <stackLimit>50</stackLimit>
                <resourceReadoutPriority>First</resourceReadoutPriority>
            </value>
        </li>

        <li Class="PatchOperationAttributeSet">
            <xpath>Defs/ThingDef[defName="DankPyon_Weapon_PotFire"]</xpath>
            <attribute>Class</attribute>
            <value>CombatExtended.AmmoDef</value>
        </li>

        <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="DankPyon_Weapon_PotFire"]/comps</xpath>
            <value>
            <li Class="CombatExtended.CompProperties_ExplosiveCE">
                <damageAmountBase>1</damageAmountBase>
                <explosiveDamageType>Flame</explosiveDamageType>
                <explosiveRadius>1.1</explosiveRadius>
                <preExplosionSpawnThingDef>Filth_Fuel</preExplosionSpawnThingDef>
                <preExplosionSpawnChance>1</preExplosionSpawnChance>
            </li>
            </value>
        </li>

        <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
            <defName>DankPyon_Weapon_PotFire</defName>
            <statBases>
                <Mass>0.6</Mass>
                <Bulk>1.8</Bulk>
                <MarketValue>3</MarketValue>
                <RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
                <SightsEfficiency>0.65</SightsEfficiency>
            </statBases>
            <Properties>
                <label>throw fire pot</label>
                <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
                <hasStandardCommand>true</hasStandardCommand>
                <range>10</range>
                <minRange>3</minRange>
                <warmupTime>1.8</warmupTime>
                <noiseRadius>4</noiseRadius>
                <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
                <soundCast>ThrowMolotovCocktail</soundCast>
                <targetParams>
                    <canTargetLocations>true</canTargetLocations>
                </targetParams>
                <defaultProjectile>DankPyon_Proj_PotFire</defaultProjectile>
                <ignorePartialLoSBlocker>true</ignorePartialLoSBlocker>
            </Properties>
            <weaponTags>
                <li>CE_OneHandedWeapon</li>
            </weaponTags>
        </li>

    <li Class="PatchOperationRemove">
        <xpath>Defs/ThingDef[defName="DankPyon_Weapon_PotFire"]/costList</xpath>
    </li>

    <li Class="PatchOperationAdd">
        <xpath>Defs</xpath>
        <value>
        <RecipeDef ParentName="GrenadeRecipeBase">
            <defName>MakeFireBomb</defName>
            <label>make fire bombs x10</label>
            <description>Craft 10 fire bombs.</description>
            <jobString>Making fire bombs.</jobString>
            <workAmount>1200</workAmount>
            <recipeUsers>
            <li>CraftingSpot</li>
            </recipeUsers>
            <ingredients>
            <li>
                <filter>
                <thingDefs>
                    <li>Cloth</li>
                </thingDefs>
                </filter>
                <count>10</count>
            </li>
            <li>
                <filter>
                <thingDefs>
                    <li>DankPyon_Tar</li>
                </thingDefs>
                </filter>
                <count>26</count>
            </li>
            </ingredients>
            <fixedIngredientFilter>
            <thingDefs>
                <li>Cloth</li>
                <li>DankPyon_Tar</li>
            </thingDefs>
            </fixedIngredientFilter>
            <products>
                <DankPyon_Weapon_PotFire>10</DankPyon_Weapon_PotFire>
            </products>
        </RecipeDef>
        </value>
    </li>


        </operations>
	</match>
    </Operation>
</Patch>