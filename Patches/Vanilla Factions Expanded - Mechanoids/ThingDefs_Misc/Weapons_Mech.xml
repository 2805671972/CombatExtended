<?xml version="1.0" encoding="utf-8" ?>
<Patch>

  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Vanilla Factions Expanded - Mechanoids</li>
    </mods>

    <match Class="PatchOperationSequence">
      <operations>

    <!-- ========== VFE Handheld Mini Turret ========== -->

    <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
      <defName>VFE_Gun_CombatMechanoidGun</defName>
      <statBases>
        <RangedWeapon_Cooldown>0.35</RangedWeapon_Cooldown>
        <SightsEfficiency>1</SightsEfficiency>
        <ShotSpread>0.07</ShotSpread>
        <SwayFactor>0.82</SwayFactor>
        <Bulk>10.00</Bulk>
      </statBases>
      <Properties>
        <recoilAmount>0.76</recoilAmount>
        <verbClass>CombatExtended.Verb_ShootCE</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <defaultProjectile>Bullet_556x45mmNATO_FMJ</defaultProjectile>
        <warmupTime>1.3</warmupTime>
        <range>48</range>
        <ticksBetweenBurstShots>5</ticksBetweenBurstShots>
        <burstShotCount>10</burstShotCount>
        <soundCast>GunShotA</soundCast>
        <soundCastTail>GunTail_Light</soundCastTail>
        <muzzleFlashScale>9</muzzleFlashScale>
        <recoilPattern>Mounted</recoilPattern>
      </Properties>
      <AmmoUser>
        <magazineSize>100</magazineSize>
        <reloadTime>7.8</reloadTime>
        <ammoSet>AmmoSet_556x45mmNATO</ammoSet>
      </AmmoUser>
      <FireModes>
        <aiAimMode>AimedShot</aiAimMode>
        <noSnapshot>true</noSnapshot>
        <noSingleShot>true</noSingleShot>
      </FireModes>
    </li>

    <!-- ========== Light Charge Blaster ========== -->
    <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
      <defName>VFE_Gun_ChargeBlasterLight</defName>
      <statBases>
        <Mass>3.0</Mass>
        <RangedWeapon_Cooldown>0.36</RangedWeapon_Cooldown>
        <SightsEfficiency>1.10</SightsEfficiency>
        <ShotSpread>0.08</ShotSpread>
        <SwayFactor>1.20</SwayFactor>
        <Bulk>7.00</Bulk>
        <WorkToMake>48000</WorkToMake>
      </statBases>
      <Properties>
        <recoilAmount>1.51</recoilAmount>
        <verbClass>CombatExtended.Verb_ShootCE</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <defaultProjectile>Bullet_6x24mmCharged</defaultProjectile>
        <warmupTime>1.0</warmupTime>
        <range>55</range>
        <ticksBetweenBurstShots>5</ticksBetweenBurstShots>
        <burstShotCount>6</burstShotCount>
        <soundCast>Shot_ChargeRifle</soundCast>
        <soundCastTail>GunTail_Medium</soundCastTail>
        <muzzleFlashScale>9</muzzleFlashScale>
      </Properties>
      <AmmoUser>
        <magazineSize>30</magazineSize>
        <reloadTime>4</reloadTime>
        <ammoSet>AmmoSet_6x24mmCharged</ammoSet>
      </AmmoUser>
      <FireModes>
        <aimedBurstShotCount>3</aimedBurstShotCount>
        <aiUseBurstMode>TRUE</aiUseBurstMode>
        <aiAimMode>AimedShot</aiAimMode>
      </FireModes>
    </li>

    <!-- ========== Remove VFE Advanced Needle Gun and patch in replacement. ========== -->

    <li Class="PatchOperationRemove">
      <xpath>Defs/ThingDef[defName="VFE_Gun_AdvancedNeedle"]</xpath>
    </li>

    <li Class="PatchOperationAdd">
      <xpath>Defs</xpath>
      <value>
        <ThingDef ParentName="BaseGunWithQuality">
          <defName>VFE_AdvancedExplosiveBoltProjector</defName>
          <label>explosive bolt projector</label>
          <description>A low-velocity, high-trajectory fire support system deployed by mechanoid Pikeman. While inaccurate and slow-firing, it remains a potent weapon against static targets.</description>
          <graphicData>
            <texPath>Things/Item/Equipment/WeaponRanged/NeedleGun</texPath>
            <graphicClass>Graphic_Single</graphicClass>
          </graphicData>
          <soundInteract>Interact_Rifle</soundInteract>
          <statBases>
            <SightsEfficiency>1</SightsEfficiency>
            <ShotSpread>0.16</ShotSpread>
            <SwayFactor>1.00</SwayFactor>
            <Bulk>7.31</Bulk>
            <Mass>20.00</Mass>
            <RangedWeapon_Cooldown>6</RangedWeapon_Cooldown>
            <MarketValue>1600</MarketValue>      
          </statBases>
          <techLevel>Spacer</techLevel>
          <menuHidden>True</menuHidden>
          <tradeability>None</tradeability>
          <destroyOnDrop>true</destroyOnDrop>    
          <weaponTags>
            <li>VFE_AdvMechanoidGunLongRange</li>  
          </weaponTags>
          <verbs>
          <li Class="CombatExtended.VerbPropertiesCE">
          <verbClass>CombatExtended.Verb_ShootMortarCE</verbClass>
          <forceNormalTimeSpeed>false</forceNormalTimeSpeed>
          <hasStandardCommand>true</hasStandardCommand>
          <defaultProjectile>Bullet_60mmMortarShell_HE</defaultProjectile>
          <warmupTime>3</warmupTime>
          <minRange>10</minRange>
          <range>45</range>
          <burstShotCount>3</burstShotCount>
          <soundCast>Mortar_LaunchA</soundCast>
          <muzzleFlashScale>16</muzzleFlashScale>
          <circularError>2.5</circularError>
          <indirectFirePenalty>0.2</indirectFirePenalty>
          <targetParams>
            <canTargetLocations>true</canTargetLocations>
          </targetParams>
          </li>
          </verbs>
          <comps>
          <li Class="CombatExtended.CompProperties_Charges">
          <chargeSpeeds>
            <li>30</li>
            <li>50</li>
            <li>70</li>
            <li>90</li>
          </chargeSpeeds>
          </li>	
            <li Class="CombatExtended.CompProperties_AmmoUser">
              <magazineSize>6</magazineSize>
              <reloadTime>12</reloadTime>
              <ammoSet>AmmoSet_60mmMortarShell</ammoSet>
            </li>
            <li Class="CombatExtended.CompProperties_FireModes">
              <aiUseBurstMode>FALSE</aiUseBurstMode>
              <aiAimMode>SuppressFire</aiAimMode>
            </li>
          </comps>
          <tools>
            <li Class="CombatExtended.ToolCE">
              <label>barrel</label>
              <capacities>
                <li>Blunt</li>
              </capacities>
              <power>10</power>
              <cooldownTime>2.44</cooldownTime>
              <armorPenetrationBlunt>3.5</armorPenetrationBlunt>
              <linkedBodyPartsGroup>Barrel</linkedBodyPartsGroup>
            </li>
          </tools>
          <modExtensions>
            <li Class="CombatExtended.GunDrawExtension">
              <DrawSize>1.2,1.4</DrawSize>
              <DrawOffset>0.0,0.0</DrawOffset>
            </li>
          </modExtensions>
        </ThingDef>
      </value>
    </li>

    <!-- ========== VFE Advanced Charge Lance ========== -->
    <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
      <defName>VFE_Gun_AdvancedChargeLance</defName>
      <statBases>
        <Mass>8.80</Mass>
        <RangedWeapon_Cooldown>0.55</RangedWeapon_Cooldown>
        <SightsEfficiency>1</SightsEfficiency>
        <ShotSpread>0.01</ShotSpread>
        <SwayFactor>0.88</SwayFactor>
        <Bulk>14.00</Bulk>
      </statBases>
      <Properties>
        <verbClass>CombatExtended.Verb_ShootCE</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <defaultProjectile>Bullet_5x35mmHyper</defaultProjectile>
        <warmupTime>1.8</warmupTime>
        <range>74</range>
        <burstShotCount>1</burstShotCount>
        <soundCast>ChargeLance_Fire</soundCast>
        <soundCastTail>GunTail_Heavy</soundCastTail>
        <muzzleFlashScale>9</muzzleFlashScale>
      </Properties>
      <AmmoUser>
        <magazineSize>1</magazineSize>
        <reloadTime>2.2</reloadTime>
        <ammoSet>AmmoSet_5x35mmHyper</ammoSet>
      </AmmoUser>
      <FireModes>
        <aiAimMode>AimedShot</aiAimMode>
      </FireModes>
      <weaponTags>
        <li>VFE_Gun_AdvancedChargeLance</li>
      </weaponTags>
    </li>

    <li Class="PatchOperationReplace">
      <xpath>Defs/ThingDef[defName="VFE_Gun_AdvancedChargeLance"]/tools</xpath>
      <value>
        <tools>
          <li Class="CombatExtended.ToolCE">
            <label>barrel</label>
            <capacities>
              <li>Blunt</li>
            </capacities>
            <power>11</power>
            <cooldownTime>2.74</cooldownTime>
            <armorPenetrationBlunt>3.75</armorPenetrationBlunt>
            <linkedBodyPartsGroup>Barrel</linkedBodyPartsGroup>
          </li>
        </tools>
      </value>
    </li>


      </operations>
    </match>
  </Operation>

</Patch>